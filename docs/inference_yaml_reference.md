# JESTER Inference YAML Configuration Reference

**Auto-generated from Pydantic schemas** - This document is the authoritative reference for all supported YAML configuration options.

> **Note**: This file is automatically generated from `jesterTOV/inference/config/schema.py`.
> To update this reference, run:
> ```bash
> uv run python -m jesterTOV.inference.config.generate_yaml_reference
> ```

## Overview

The JESTER inference system uses YAML configuration files validated by Pydantic models. This reference documents every supported field, its type, default value, and purpose.

---

## Complete Configuration Template

```yaml
# Complete JESTER inference configuration with all available options

# Top-level configuration
seed: 43
dry_run: False
validate_only: False

# Transform configuration
transform:
  type: "..."
  ndat_metamodel: 100
  nmax_nsat: 25.0
  nb_CSE: 8
  min_nsat_TOV: 0.75
  ndat_TOV: 100
  nb_masses: 100
  crust_name: "DH"

# Prior configuration
prior:
  specification_file: "prior.prior"

# Likelihoods (list of likelihood configurations)
likelihoods:
  - type: "gw"  # or "nicer", "radio", "chieft", "rex", "zero"
    enabled: true
    parameters:
      # Likelihood-specific parameters (see section below)

# Sampler configuration
sampler:
  n_chains: 20
  n_loop_training: 3
  n_loop_production: 3
  n_local_steps: 100
  n_global_steps: 100
  n_epochs: 30
  learning_rate: 0.001
  output_dir: "./outdir/"
  train_thinning: 1
  output_thinning: 5
  n_eos_samples: 10000

# Data paths (optional overrides)
data_paths: {}
```

---

## Field Reference

### Top-Level Configuration

- `seed`: `int` (optional)
  - Default: `43`

- `transform`: `TransformConfig` (**required**)

- `prior`: `PriorConfig` (**required**)

- `likelihoods`: `list[LikelihoodConfig]` (**required**)

- `sampler`: `SamplerConfig` (**required**)

- `data_paths`: `dict[str, str]` (optional)
  - Default: `{}`

- `dry_run`: `bool` (optional)
  - Default: `False`

- `validate_only`: `bool` (optional)
  - Default: `False`
### Transform Configuration (`transform:`)

Defines how EOS parameters are transformed to observables.

- `type`: `"metamodel" | "metamodel_cse"` (**required**)

- `ndat_metamodel`: `int` (optional)
  - Default: `100`

- `nmax_nsat`: `float` (optional)
  - Default: `25.0`

- `nb_CSE`: `int` (optional)
  - Default: `8`

- `min_nsat_TOV`: `float` (optional)
  - Default: `0.75`

- `ndat_TOV`: `int` (optional)
  - Default: `100`

- `nb_masses`: `int` (optional)
  - Default: `100`

- `crust_name`: `"DH" | "BPS" | "DH_fixed"` (optional)
  - Default: `"DH"`
**Validation Rules**:
- If `type: "metamodel"`, then `nb_CSE` must be 0 (or omitted)
- If `type: "metamodel_cse"`, then `nb_CSE` must be > 0
- `crust_name` must be one of: `"DH"`, `"BPS"`, or `"DH_fixed"`

### Prior Configuration (`prior:`)

Specifies prior distributions for parameters.

- `specification_file`: `str` (**required**)
### Likelihood Configuration (`likelihoods:`)

List of observational constraints. Each likelihood has:

- `type`: `"gw" | "nicer" | "radio" | "chieft" | "rex" | "zero"` (**required**)

- `enabled`: `bool` (optional)
  - Default: `True`

- `parameters`: `dict[str, Any]` (optional)
  - Default: `{}`
**Likelihood-Specific Parameters** (`parameters:`):

#### Gravitational Wave (`type: "gw"`)

```yaml
- type: "gw"
  enabled: true
  parameters:
    event_name: "GW170817"          # GW event name
    model_path: "./NFs/model.eqx"   # Path to normalizing flow model
    very_negative_value: -9999999.0  # Return for invalid M-R (optional)
```

#### NICER X-ray Timing (`type: "nicer"`)

```yaml
- type: "nicer"
  enabled: true
  parameters:
    targets: ["J0030", "J0740"]              # Pulsar names
    analysis_groups: ["amsterdam", "maryland"]  # Analysis groups to use
    m_min: 1.0                                # Min mass for marginalization
    m_max: 2.5                                # Max mass for marginalization
    nb_masses: 100                            # Mass grid size
```

#### Radio Pulsar Timing (`type: "radio"`)

```yaml
- type: "radio"
  enabled: true
  parameters:
    psr_name: "J0740+6620"  # Pulsar name (for labeling)
    mass_mean: 2.08         # Mean mass (solar masses)
    mass_std: 0.07          # Mass uncertainty (1-sigma)
    nb_masses: 100          # Mass grid size for marginalization
```

#### Chiral Effective Field Theory (`type: "chieft"`)

```yaml
- type: "chieft"
  enabled: true
  parameters:
    nb_n: 100  # Number of density points to check against bands
```

#### PREX/CREX (`type: "rex"`)

```yaml
- type: "rex"
  enabled: true
  parameters:
    experiment_name: "PREX"  # "PREX" or "CREX"
```

#### Zero Likelihood (`type: "zero"`)

```yaml
- type: "zero"
  enabled: true
  parameters: {}  # No parameters needed
```

### Sampler Configuration (`sampler:`)

Controls MCMC sampling via flowMC.

- `n_chains`: `int` (optional)
  - Default: `20`

- `n_loop_training`: `int` (optional)
  - Default: `3`

- `n_loop_production`: `int` (optional)
  - Default: `3`

- `n_local_steps`: `int` (optional)
  - Default: `100`

- `n_global_steps`: `int` (optional)
  - Default: `100`

- `n_epochs`: `int` (optional)
  - Default: `30`

- `learning_rate`: `float` (optional)
  - Default: `0.001`

- `output_dir`: `str` (optional)
  - Default: `"./outdir/"`

- `train_thinning`: `int` (optional)
  - Default: `1`

- `output_thinning`: `int` (optional)
  - Default: `5`

- `n_eos_samples`: `int` (optional)
  - Default: `10000`
**Sampling Phases**:
- **Training**: `n_loop_training` loops of `n_local_steps` MCMC + NF training for `n_epochs`
- **Production**: `n_loop_production` loops of `n_local_steps` MCMC + `n_global_steps` NF proposals

**Total samples** (approximate):
- Training: `n_chains × n_loop_training × n_local_steps ÷ train_thinning`
- Production: `n_chains × n_loop_production × (n_local_steps + n_global_steps) ÷ output_thinning`

### Data Paths (`data_paths:`)

Optional dictionary to override default data file locations.

**Supported keys**:

```yaml
data_paths:
  # NICER data
  nicer_j0030_amsterdam: "./data/NICER/J0030/amsterdam.txt"
  nicer_j0030_maryland: "./data/NICER/J0030/maryland.txt"
  nicer_j0740_amsterdam: "./data/NICER/J0740/amsterdam.dat"
  nicer_j0740_maryland: "./data/NICER/J0740/maryland.txt"
  
  # ChiEFT bands
  chieft_low: "./data/chieft/low_density.txt"
  chieft_high: "./data/chieft/high_density.txt"
  
  # GW normalizing flow models
  gw170817_model: "./NFs/GW170817/model.eqx"
  
  # REX posteriors
  prex_posterior: "./data/REX/PREX_posterior.npz"
  crex_posterior: "./data/REX/CREX_posterior.npz"
```

## Validation Rules

The configuration is validated using Pydantic. Common validation rules:

1. **Transform type consistency**:
   - `type: "metamodel"` requires `nb_CSE: 0`
   - `type: "metamodel_cse"` requires `nb_CSE > 0`

2. **Prior file extension**:
   - Must end with `.prior`

3. **Likelihood requirements**:
   - At least one likelihood must have `enabled: true`

4. **Positive values**:
   - `n_chains`, `n_loop_training`, `n_loop_production` must be > 0
   - `learning_rate` must be in (0, 1]

5. **Valid crust models**:
   - `crust_name` must be `"DH"`, `"BPS"`, or `"DH_fixed"`

## Complete Examples

### Minimal Configuration (Prior-only)

```yaml
seed: 43

transform:
  type: "metamodel"

prior:
  specification_file: "prior.prior"

likelihoods:
  - type: "zero"
    enabled: true

sampler:
  n_chains: 10
  n_loop_training: 2
  n_loop_production: 2
  output_dir: "./outdir/"
```

### Full Multi-Messenger Configuration

```yaml
seed: 43

transform:
  type: "metamodel_cse"
  nb_CSE: 8
  ndat_metamodel: 100
  nmax_nsat: 25.0

prior:
  specification_file: "prior.prior"

likelihoods:
  - type: "gw"
    enabled: true
    parameters:
      event_name: "GW170817"
      sample_masses: true
  
  - type: "nicer"
    enabled: true
    parameters:
      targets: ["J0030", "J0740"]
  
  - type: "radio"
    enabled: true
    parameters:
      mass_mean: 2.08
      mass_std: 0.07
  
  - type: "chieft"
    enabled: true

sampler:
  n_chains: 20
  n_loop_training: 3
  n_loop_production: 5
  n_local_steps: 200
  n_global_steps: 200
  output_dir: "./outdir/"
```

---

**Document Status**: Auto-generated
**Source**: `jesterTOV/inference/config/schema.py`
**Generator**: `jesterTOV/inference/config/generate_yaml_reference.py`

To regenerate this reference:
```bash
uv run python -m jesterTOV.inference.config.generate_yaml_reference
```
