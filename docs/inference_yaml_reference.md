# JESTER Inference YAML Configuration Reference

**Auto-generated from Pydantic schemas** - This document is the authoritative reference for all supported YAML configuration options.

> **Note**: This file is automatically generated from `jesterTOV/inference/config/schema.py`.
> To update this reference, run:
> ```bash
> uv run python -m jesterTOV.inference.config.generate_yaml_reference
> ```

## Overview

The JESTER inference system uses YAML configuration files validated by Pydantic models. This reference documents every supported field, its type, default value, and purpose.

---

## Complete Configuration Template

```yaml
# Complete JESTER inference configuration with all available options

# Top-level configuration
seed: 43
postprocessing: enabled=True make_cornerplot=True make_massradius=True make_pressuredensity=True make_histograms=True make_contours=True prior_dir=None
dry_run: False
validate_only: False

# Transform configuration
transform:
  type: "..."
  ndat_metamodel: 100
  nmax_nsat: 25.0
  nb_CSE: 8
  n_points_high: 500
  min_nsat_TOV: 0.75
  ndat_TOV: 100
  nb_masses: 100
  crust_name: "DH"

# Prior configuration
prior:
  specification_file: "prior.prior"

# Likelihoods (list of likelihood configurations)
likelihoods:
  - type: "gw"  # or "nicer", "radio", "chieft", "rex", "zero"
    enabled: true
    parameters:
      # Likelihood-specific parameters (see section below)

# Sampler configuration (choose one type)
sampler:
  type: "flowmc"  # or "blackjax-ns-aw", "smc-rw", "smc-nuts"
  # See sampler-specific fields below

# Data paths (optional overrides)
data_paths: {}
```

---

## Field Reference

### Top-Level Configuration

- `seed`: `int` (optional)
  - Default: `43`

- `transform`: `TransformConfig` (**required**)

- `prior`: `PriorConfig` (**required**)

- `likelihoods`: `list[LikelihoodConfig]` (**required**)

- `sampler`: `typing.Union[jesterTOV.inference.config.schema.FlowMCSamplerConfig, jesterTOV.inference.config.schema.BlackJAXNSAWConfig, jesterTOV.inference.config.schema.SMCRandomWalkSamplerConfig, jesterTOV.inference.config.schema.SMCNUTSSamplerConfig]` (**required**)

- `postprocessing`: `PostprocessingConfig` (optional)
  - Default: `enabled=True make_cornerplot=True make_massradius=True make_pressuredensity=True make_histograms=True make_contours=True prior_dir=None`

- `data_paths`: `dict[str, str]` (optional)
  - Default: `{}`

- `dry_run`: `bool` (optional)
  - Default: `False`

- `validate_only`: `bool` (optional)
  - Default: `False`
### Transform Configuration (`transform:`)

Defines how EOS parameters are transformed to observables.

- ``type``: `"metamodel" | "metamodel_cse" | "spectral"` (**required**)

- `ndat_metamodel`: `int` (optional)
  - Default: `100`

- `nmax_nsat`: `float` (optional)
  - Default: `25.0`

- `nb_CSE`: `int` (optional)
  - Default: `8`

- `n_points_high`: `int` (optional)
  - Default: `500`

- `min_nsat_TOV`: `float` (optional)
  - Default: `0.75`

- `ndat_TOV`: `int` (optional)
  - Default: `100`

- `nb_masses`: `int` (optional)
  - Default: `100`

- `crust_name`: `"DH" | "BPS" | "DH_fixed" | "SLy"` (optional)
  - Default: `"DH"`
**Validation Rules**:
- If `type: "metamodel"`, then `nb_CSE` must be 0 (or omitted)
- If `type: "metamodel_cse"`, then `nb_CSE` must be > 0
- If `type: "spectral"`, then:
  - `crust_name` must be `"SLy"` (LALSuite compatibility requirement)
  - `nb_CSE` must be 0
  - `n_points_high` defines high-density spectral region sampling (default: 500)
- `crust_name` must be one of: `"DH"`, `"BPS"`, `"DH_fixed"`, or `"SLy"`

### Prior Configuration (`prior:`)

Specifies prior distributions for parameters.

- `specification_file`: `str` (**required**)
### Likelihood Configuration (`likelihoods:`)

List of observational constraints. Each likelihood has:

- ``type``: `"gw" | "gw_resampled" | "nicer" | "radio" | "chieft" | "rex" | "constraints" | "constraints_eos" | "constraints_tov" | "constraints_gamma" | "zero"` (**required**)

- `enabled`: `bool` (optional)
  - Default: `True`

- `parameters`: `dict[str, Any]` (optional)
  - Default: `{}`
**Likelihood-Specific Parameters** (`parameters:`):

#### Gravitational Wave (`type: "gw"`)

```yaml
- type: "gw"
  enabled: true
  parameters:
    event_name: "GW170817"          # GW event name
    model_path: "./NFs/model.eqx"   # Path to normalizing flow model
    very_negative_value: -9999999.0  # Return for invalid M-R (optional)
```

#### NICER X-ray Timing (`type: "nicer"`)

```yaml
- type: "nicer"
  enabled: true
  parameters:
    targets: ["J0030", "J0740"]              # Pulsar names
    analysis_groups: ["amsterdam", "maryland"]  # Analysis groups to use
    m_min: 1.0                                # Min mass for marginalization
    m_max: 2.5                                # Max mass for marginalization
    nb_masses: 100                            # Mass grid size
```

#### Radio Pulsar Timing (`type: "radio"`)

```yaml
- type: "radio"
  enabled: true
  parameters:
    psr_name: "J0740+6620"  # Pulsar name (for labeling)
    mass_mean: 2.08         # Mean mass (solar masses)
    mass_std: 0.07          # Mass uncertainty (1-sigma)
    nb_masses: 100          # Mass grid size for marginalization
```

#### Chiral Effective Field Theory (`type: "chieft"`)

```yaml
- type: "chieft"
  enabled: true
  parameters:
    nb_n: 100  # Number of density points to check against bands
```

#### PREX/CREX (`type: "rex"`)

```yaml
- type: "rex"
  enabled: true
  parameters:
    experiment_name: "PREX"  # "PREX" or "CREX"
```

#### Zero Likelihood (`type: "zero"`)

```yaml
- type: "zero"
  enabled: true
  parameters: {}  # No parameters needed
```

### Sampler Configuration (`sampler:`)

The sampler configuration uses a discriminated union based on the `type` field. Choose one of:

#### FlowMC Sampler (`type: "flowmc"`)

Normalizing flow-enhanced MCMC with local and global sampling phases.

- `output_dir`: `str` (optional)
  - Default: `"./outdir/"`

- `n_eos_samples`: `int` (optional)
  - Default: `10000`

- `log_prob_batch_size`: `int` (optional)
  - Default: `1000`

- ``type``: `"flowmc"` (optional)
  - Default: `"flowmc"`

- `n_chains`: `int` (optional)
  - Default: `20`

- `n_loop_training`: `int` (optional)
  - Default: `3`

- `n_loop_production`: `int` (optional)
  - Default: `3`

- `n_local_steps`: `int` (optional)
  - Default: `100`

- `n_global_steps`: `int` (optional)
  - Default: `100`

- `n_epochs`: `int` (optional)
  - Default: `30`

- `learning_rate`: `float` (optional)
  - Default: `0.001`

- `train_thinning`: `int` (optional)
  - Default: `1`

- `output_thinning`: `int` (optional)
  - Default: `5`

**Sampling Phases**:
- **Training**: `n_loop_training` loops of `n_local_steps` MCMC + NF training for `n_epochs`
- **Production**: `n_loop_production` loops of `n_local_steps` MCMC + `n_global_steps` NF proposals

#### Nested Sampling (`type: "nested_sampling"`)

BlackJAX nested sampling with acceptance walk for Bayesian evidence estimation.

- `output_dir`: `str` (optional)
  - Default: `"./outdir/"`

- `n_eos_samples`: `int` (optional)
  - Default: `10000`

- `log_prob_batch_size`: `int` (optional)
  - Default: `1000`

- ``type``: `"blackjax-ns-aw"` (optional)
  - Default: `"blackjax-ns-aw"`

- `n_live`: `int` (optional)
  - Default: `1000`

- `n_delete_frac`: `float` (optional)
  - Default: `0.5`

- `n_target`: `int` (optional)
  - Default: `60`

- `max_mcmc`: `int` (optional)
  - Default: `5000`

- `max_proposals`: `int` (optional)
  - Default: `1000`

- `termination_dlogz`: `float` (optional)
  - Default: `0.1`

**Output**: Evidence (logZ Â± error) and posterior samples with importance weights.

#### Sequential Monte Carlo with Random Walk (`type: "smc-rw"`)

BlackJAX SMC with adaptive tempering and Gaussian Random Walk kernel.

- `output_dir`: `str` (optional)
  - Default: `"./outdir/"`

- `n_eos_samples`: `int` (optional)
  - Default: `10000`

- `log_prob_batch_size`: `int` (optional)
  - Default: `1000`

- ``type``: `"smc-rw"` (optional)
  - Default: `"smc-rw"`

- `n_particles`: `int` (optional)
  - Default: `10000`

- `n_mcmc_steps`: `int` (optional)
  - Default: `1`

- `target_ess`: `float` (optional)
  - Default: `0.9`

- `random_walk_sigma`: `float` (optional)
  - Default: `1.0`

**Output**: Posterior samples and effective sample size (ESS) statistics.

#### Sequential Monte Carlo with NUTS (`type: "smc-nuts"`)

BlackJAX SMC with adaptive tempering and NUTS kernel (EXPERIMENTAL).

- `output_dir`: `str` (optional)
  - Default: `"./outdir/"`

- `n_eos_samples`: `int` (optional)
  - Default: `10000`

- `log_prob_batch_size`: `int` (optional)
  - Default: `1000`

- ``type``: `"smc-nuts"` (optional)
  - Default: `"smc-nuts"`

- `n_particles`: `int` (optional)
  - Default: `10000`

- `n_mcmc_steps`: `int` (optional)
  - Default: `1`

- `target_ess`: `float` (optional)
  - Default: `0.9`

- `init_step_size`: `float` (optional)
  - Default: `0.01`

- `mass_matrix_base`: `float` (optional)
  - Default: `0.2`

- `mass_matrix_param_scales`: `dict[str, float]` (optional)
  - Default: `{}`

- `target_acceptance`: `float` (optional)
  - Default: `0.7`

- `adaptation_rate`: `float` (optional)
  - Default: `0.3`

**Output**: Posterior samples and effective sample size (ESS) statistics.

### Data Paths (`data_paths:`)

Optional dictionary to override default data file locations.

**Supported keys**:

```yaml
data_paths:
  # NICER data
  nicer_j0030_amsterdam: "./data/NICER/J0030/amsterdam.txt"
  nicer_j0030_maryland: "./data/NICER/J0030/maryland.txt"
  nicer_j0740_amsterdam: "./data/NICER/J0740/amsterdam.dat"
  nicer_j0740_maryland: "./data/NICER/J0740/maryland.txt"
  
  # ChiEFT bands
  chieft_low: "./data/chieft/low_density.txt"
  chieft_high: "./data/chieft/high_density.txt"
  
  # GW normalizing flow models
  gw170817_model: "./NFs/GW170817/model.eqx"
  
  # REX posteriors
  prex_posterior: "./data/REX/PREX_posterior.npz"
  crex_posterior: "./data/REX/CREX_posterior.npz"
```

## Validation Rules

The configuration is validated using Pydantic. Common validation rules:

1. **Transform type consistency**:
   - `type: "metamodel"` requires `nb_CSE: 0`
   - `type: "metamodel_cse"` requires `nb_CSE > 0`
   - `type: "spectral"` requires:
     - `crust_name: "SLy"` (LALSuite compatibility)
     - `nb_CSE: 0`
     - `constraints_gamma` likelihood should be enabled for Gamma bounds

2. **Prior file extension**:
   - Must end with `.prior`

3. **Likelihood requirements**:
   - At least one likelihood must have `enabled: true`

4. **Positive values**:
   - `n_chains`, `n_loop_training`, `n_loop_production` must be > 0
   - `learning_rate` must be in (0, 1]

5. **Valid crust models**:
   - `crust_name` must be `"DH"`, `"BPS"`, `"DH_fixed"`, or `"SLy"`
   - Spectral transform specifically requires `"SLy"` for LALSuite compatibility

## Complete Examples

### Minimal Configuration (Prior-only)

```yaml
seed: 43

transform:
  type: "metamodel"

prior:
  specification_file: "prior.prior"

likelihoods:
  - type: "zero"
    enabled: true

sampler:
  n_chains: 10
  n_loop_training: 2
  n_loop_production: 2
  output_dir: "./outdir/"
```

### Full Multi-Messenger Configuration

```yaml
seed: 43

transform:
  type: "metamodel_cse"
  nb_CSE: 8
  ndat_metamodel: 100
  nmax_nsat: 25.0

prior:
  specification_file: "prior.prior"

likelihoods:
  - type: "gw"
    enabled: true
    parameters:
      event_name: "GW170817"
  
  - type: "nicer"
    enabled: true
    parameters:
      targets: ["J0030", "J0740"]
  
  - type: "radio"
    enabled: true
    parameters:
      mass_mean: 2.08
      mass_std: 0.07
  
  - type: "chieft"
    enabled: true

sampler:
  n_chains: 20
  n_loop_training: 3
  n_loop_production: 5
  n_local_steps: 200
  n_global_steps: 200
  output_dir: "./outdir/"
```

---

**Document Status**: Auto-generated
**Source**: `jesterTOV/inference/config/schema.py`
**Generator**: `jesterTOV/inference/config/generate_yaml_reference.py`

To regenerate this reference:
```bash
uv run python -m jesterTOV.inference.config.generate_yaml_reference
```
