name: Nightly E2E Tests

on:
  schedule:
    # Run at 2 AM UTC daily
    - cron: '0 2 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # E2E tests may take longer

    strategy:
      matrix:
        python-version: ["3.11"]  # Run on single Python version for nightly

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v6
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install uv
      uses: astral-sh/setup-uv@v4

    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-latex-base texlive-latex-extra dvipng cm-super

    - name: Install dependencies
      run: |
        uv sync --frozen --extra dev

    - name: Run E2E tests (including slow tests)
      run: |
        uv run pytest tests/test_inference/test_e2e/ -v --timeout=600

    - name: Run full test suite with slow tests
      run: |
        uv run pytest tests/ -v --timeout=600
